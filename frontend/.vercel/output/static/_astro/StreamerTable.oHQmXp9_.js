import{j as e,S as y}from"./api.R820zOtF.js";import{r as n}from"./index.BJfUAbRs.js";import{T as C}from"./TimeRangeSelector.Ctx6NCK6.js";function P({limit:g=20}){const[v,p]=n.useState([]),[i,j]=n.useState("7d"),[w,x]=n.useState(!0),[u,d]=n.useState(null),[t,N]=n.useState("peak_viewers"),[c,f]=n.useState("desc"),[b,h]=n.useState("real");n.useEffect(()=>{async function s(){try{x(!0),console.log("Intentando obtener top streamers...");const r=await y.getTop(g);if(console.log("Top streamers obtenidos:",r),r.length===1&&r[0].streamer_name==="Ejemplo"){d("No se pudieron cargar los datos reales de streamers."),h("fallback"),x(!1);return}if(r.length===0){d("No hay datos de streamers disponibles"),p([]),x(!1);return}try{console.log("Obteniendo estadísticas avanzadas para streamers...");const o=r.map(a=>y.getAdvancedStats(a.streamer_name,i).catch(E=>(console.error(`Error al obtener estadísticas para ${a.streamer_name}:`,E),{streamer_name:a.streamer_name,hours_streamed:0,avg_viewers:a.viewers_count||0,peak_viewers:a.viewers_count||0,games_streamed:[a.game||"Sin datos"],active_days:0,time_range:i}))),l=await Promise.all(o);console.log("Estadísticas avanzadas obtenidas:",l),p(l),h("real"),d(null)}catch(o){console.error("Error al procesar estadísticas de streamers:",o),d("Error al procesar estadísticas de streamers");const l=r.map(a=>({streamer_name:a.streamer_name,hours_streamed:0,avg_viewers:a.viewers_count||0,peak_viewers:a.viewers_count||0,games_streamed:[a.game||"Sin datos"],active_days:0,time_range:i}));p(l),h("partial")}}catch(r){console.error("Error al obtener streamers:",r),d("No se pudieron cargar los datos de streamers"),p([]),h("fallback")}finally{x(!1)}}s()},[i,g]);const _=s=>{j(s)},m=s=>{t===s?f(c==="asc"?"desc":"asc"):(N(s),f("desc"))},S=[...v].sort((s,r)=>{const o=s[t],l=r[t];return t==="streamer_name"?c==="asc"?o.localeCompare(l):l.localeCompare(o):c==="asc"?o-l:l-o}),k=s=>{switch(s){case"7d":return"últimos 7 días";case"1m":return"último mes";case"3m":return"últimos 3 meses";case"all":return"todo el tiempo";default:return s}};return w?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Top Streamers"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["Estadísticas para los ",k(i)]}),u&&e.jsxs("div",{className:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded relative mb-6",role:"alert",children:[e.jsx("strong",{className:"font-bold",children:"Atención:"}),e.jsxs("span",{className:"block sm:inline",children:[" ",u]}),e.jsxs("p",{className:"mt-2",children:["Verifica la conexión con la API y asegúrate de que el servidor esté funcionando correctamente.",e.jsx("a",{href:"/diagnostico",className:"underline font-medium ml-2",children:"Ir a la página de diagnóstico"})]})]}),b==="partial"&&!u&&e.jsxs("div",{className:"bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded relative mb-6",role:"alert",children:[e.jsx("strong",{className:"font-bold",children:"Información:"}),e.jsx("span",{className:"block sm:inline",children:" Algunos datos pueden estar incompletos o ser aproximados."})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Período de tiempo:"}),e.jsx(C,{selectedRange:i,onChange:_})]})]}),v.length===0?e.jsx("div",{className:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded relative",role:"alert",children:e.jsx("span",{className:"block sm:inline",children:"No se encontraron streamers para mostrar."})}):e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>m("streamer_name"),children:e.jsxs("div",{className:"flex items-center",children:["Streamer",t==="streamer_name"&&e.jsx("span",{className:"ml-1",children:c==="asc"?"↑":"↓"})]})}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>m("hours_streamed"),children:e.jsxs("div",{className:"flex items-center",children:["Horas Streameadas",t==="hours_streamed"&&e.jsx("span",{className:"ml-1",children:c==="asc"?"↑":"↓"})]})}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>m("avg_viewers"),children:e.jsxs("div",{className:"flex items-center",children:["Media de Viewers",t==="avg_viewers"&&e.jsx("span",{className:"ml-1",children:c==="asc"?"↑":"↓"})]})}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>m("peak_viewers"),children:e.jsxs("div",{className:"flex items-center",children:["Peak Viewers",t==="peak_viewers"&&e.jsx("span",{className:"ml-1",children:c==="asc"?"↑":"↓"})]})}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>m("active_days"),children:e.jsxs("div",{className:"flex items-center",children:["Días Activos",t==="active_days"&&e.jsx("span",{className:"ml-1",children:c==="asc"?"↑":"↓"})]})}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Juegos"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:S.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("a",{href:`/streamer/${s.streamer_name}`,className:"text-purple-600 hover:text-purple-900 font-medium",children:s.streamer_name})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-gray-700",children:[s.hours_streamed,"h"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-gray-700",children:s.avg_viewers.toLocaleString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-gray-700",children:s.peak_viewers.toLocaleString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-gray-700",children:s.active_days}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-gray-700",children:[s.games_streamed.slice(0,2).join(", "),s.games_streamed.length>2&&"..."]})]},s.streamer_name))})]})})})]})}export{P as default};
